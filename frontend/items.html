<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Match Analysis | Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE THEME --- */
        :root {
            --primary: #4f46e5;
            --secondary: #06b6d4;
            --accent: #8b5cf6;
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f3f4f6;
            overflow-x: hidden;
            color: #1f2937;
        }

        .font-tech { font-family: 'Space Grotesk', sans-serif; }

        /* --- SMOOTH TRANSITIONS --- */
        * {
            transition: background-color 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- ANIMATED BACKGROUND --- */
        .bg-mesh {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1;
            background: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-size: 200% 200%;
            animation: gradientMove 20s ease-in-out infinite;
        }
        
        .bg-mesh::before {
            content: "";
            position: absolute; inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- GLASS CARDS --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .glass-panel:hover {
            box-shadow: 0 12px 48px 0 rgba(79, 70, 229, 0.2);
            transform: translateY(-2px);
        }

        /* --- ANIMATIONS --- */
        .slide-up { 
            animation: slideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; 
            opacity: 0; 
            transform: translateY(30px); 
        }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }

        @keyframes slideUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Scanner Effect */
        .scanner-line {
            position: absolute;
            top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(to right, transparent, #4f46e5, transparent);
            box-shadow: 0 0 15px #4f46e5;
            animation: scan 4s ease-in-out infinite;
            z-index: 10;
            opacity: 0.6;
        }
        @keyframes scan {
            0%, 100% { top: 0%; opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { top: 100%; opacity: 0; }
        }

        /* Skeleton Shimmer */
        .skeleton {
            background: linear-gradient(90deg, #e5e7eb 25%, #f3f4f6 50%, #e5e7eb 75%);
            background-size: 200% 100%;
            animation: shimmer 2s ease-in-out infinite;
            color: transparent !important;
            border-radius: 6px;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Smooth Group Hover Effects */
        .group-hover\:scale-110 {
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Smooth Button Transitions */
        button {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        button:hover {
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        /* Smooth Icon Transitions */
        i {
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Smooth Image Transitions */
        img {
            transition: transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Smooth Opacity & Grayscale */
        .opacity-50 {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .grayscale {
            transition: filter 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body class="min-h-screen">
    
    <div class="bg-mesh"></div>

    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <div class="flex justify-between items-center mb-10 slide-up">
            <button onclick="history.back()" class="group flex items-center gap-3 px-5 py-2.5 rounded-full glass-panel hover:bg-white transition-all duration-300">
                <i class="fas fa-arrow-left text-gray-500 group-hover:-translate-x-1 transition-transform"></i>
                <span class="font-bold text-gray-700">Back to Dashboard</span>
            </button>
            <div class="hidden md:flex items-center gap-2 px-4 py-2 bg-black/20 rounded-full backdrop-blur-sm border border-white/10">
                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-xs font-mono text-white/90 tracking-widest">SYSTEM ONLINE</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-8 space-y-6">
                
                <div class="glass-panel rounded-3xl p-8 relative overflow-hidden slide-up delay-100">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>
                    
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 relative z-10">
                        <div>
                            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-lg bg-indigo-100/50 border border-indigo-200 text-indigo-700 mb-3">
                                <i class="fas fa-microchip animate-pulse"></i>
                                <span class="text-xs font-bold uppercase tracking-wider">AI Verification Protocol</span>
                            </div>
                            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 tracking-tight mb-2">
                                Match <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-cyan-500">Analysis</span>
                            </h1>
                            <div class="flex items-center gap-4 text-sm font-medium text-gray-500">
                                <span class="bg-white/50 px-2 py-1 rounded border border-gray-200">ID: <span id="displayMatchId" class="skeleton">----</span></span>
                                <span class="text-gray-300">|</span>
                                <span id="displayDate" class="skeleton">Loading Date...</span>
                            </div>
                        </div>

                        <div class="relative group">
                            <div class="absolute inset-0 bg-indigo-500/20 blur-xl rounded-full group-hover:bg-indigo-500/30 transition-all duration-500"></div>
                            <svg class="w-32 h-32 transform -rotate-90 relative z-10 drop-shadow-lg">
                                <circle cx="64" cy="64" r="56" stroke="white" stroke-width="8" fill="white" class="opacity-90 shadow-sm" />
                                <circle cx="64" cy="64" r="56" stroke="#e5e7eb" stroke-width="8" fill="transparent" />
                                <circle id="scoreRing" cx="64" cy="64" r="56" stroke="url(#gradient)" stroke-width="8" stroke-linecap="round" fill="transparent" stroke-dasharray="351" stroke-dashoffset="351" class="transition-all duration-1000 ease-out" />
                                <defs>
                                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stop-color="#4f46e5" />
                                        <stop offset="100%" stop-color="#06b6d4" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center z-20">
                                <span id="scoreText" class="text-3xl font-black text-gray-800 tracking-tighter">0%</span>
                                <span class="text-[10px] uppercase font-bold text-gray-400">Similarity</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-panel rounded-3xl overflow-hidden shadow-xl slide-up delay-200 border-0">
    <div class="bg-gray-900/5 px-6 py-4 border-b border-gray-200/50 flex justify-between items-center backdrop-blur-sm">
        <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2">
            <i class="far fa-eye text-indigo-600"></i> Visual Evidence
        </h3>
        <div class="flex gap-2">
            <div class="w-3 h-3 rounded-full bg-red-400"></div>
            <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
            <div class="w-3 h-3 rounded-full bg-green-400"></div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 relative bg-white">
        
        <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20 hidden md:flex flex-col items-center justify-center w-14 h-14 rounded-full bg-white shadow-[0_0_20px_rgba(0,0,0,0.1)] border-4 border-gray-50">
            <span class="font-black text-indigo-600 italic text-sm">VS</span>
        </div>

        <div class="p-8 border-b md:border-b-0 md:border-r border-gray-100 group relative">
            <div class="absolute top-4 left-4 z-10 bg-purple-100/90 text-purple-700 px-3 py-1 rounded-full text-xs font-bold border border-purple-200 backdrop-blur-sm">
                REPORTED LOST
            </div>
            
            <div class="w-full h-72 bg-gray-50 rounded-2xl overflow-hidden relative border border-gray-200 shadow-sm">
                <div class="scanner-line"></div> 
                <img 
                    id="lostImage" 
                    src="" 
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" 
                    onerror="this.onerror=null; this.src='https://via.placeholder.com/400?text=No+Image'"
                >
            </div>

            <div class="mt-6">
                <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-1">Item Details</h4>
                <h3 id="lostTitle" class="text-xl font-bold text-gray-900 skeleton w-3/4 h-8 mb-2">Loading...</h3>
                <p id="lostDescription" class="text-gray-500 text-sm leading-relaxed skeleton h-12">...</p>
            </div>
        </div>

        <div class="p-8 bg-indigo-50/30 group relative">
            <div class="absolute top-4 right-4 z-10 bg-teal-100/90 text-teal-700 px-3 py-1 rounded-full text-xs font-bold border border-teal-200 backdrop-blur-sm">
                INVENTORY MATCH
            </div>
            
            <div class="w-full h-72 bg-white rounded-2xl overflow-hidden relative border border-gray-200 shadow-sm">
                <div class="scanner-line" style="animation-delay: 1.5s;"></div> 
                <img 
                    id="foundImage" 
                    src="" 
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" 
                    onerror="this.onerror=null; this.src='https://via.placeholder.com/400?text=No+Image'"
                >
            </div>

            <div class="mt-6 text-right md:text-left">
                <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-1">Item Details</h4>
                <h3 id="foundTitle" class="text-xl font-bold text-gray-900 skeleton w-3/4 h-8 mb-2">Loading...</h3>
                <p id="foundDescription" class="text-gray-500 text-sm leading-relaxed skeleton h-12">...</p>
            </div>
        </div>
    </div>
</div>

                <div class="glass-panel rounded-3xl p-8 slide-up delay-300">
                    <h3 class="font-bold text-lg text-gray-800 mb-6">Metadata Comparison</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-4 items-center p-3 rounded-xl hover:bg-white/60 transition-colors border border-transparent hover:border-gray-100">
                            <div class="text-gray-400 font-bold text-xs uppercase tracking-widest text-center md:text-left">Brand</div>
                            <div id="lostBrand" class="font-mono text-sm font-semibold text-gray-800 skeleton text-center md:text-left">...</div>
                            <div id="foundBrand" class="font-mono text-sm font-semibold text-indigo-700 skeleton text-center md:text-left">...</div>
                        </div>
                        <div class="h-px bg-gray-200/60 w-full"></div>
                        
                        <div class="grid grid-cols-3 gap-4 items-center p-3 rounded-xl hover:bg-white/60 transition-colors border border-transparent hover:border-gray-100">
                            <div class="text-gray-400 font-bold text-xs uppercase tracking-widest text-center md:text-left">Color</div>
                            <div id="lostColor" class="font-mono text-sm font-semibold text-gray-800 skeleton text-center md:text-left">...</div>
                            <div id="foundColor" class="font-mono text-sm font-semibold text-indigo-700 skeleton text-center md:text-left">...</div>
                        </div>
                        <div class="h-px bg-gray-200/60 w-full"></div>

                        <div class="grid grid-cols-3 gap-4 items-center p-3 rounded-xl hover:bg-white/60 transition-colors border border-transparent hover:border-gray-100">
                            <div class="text-gray-400 font-bold text-xs uppercase tracking-widest text-center md:text-left">Location</div>
                            <div id="lostLocation" class="font-mono text-sm font-semibold text-gray-800 skeleton text-center md:text-left">...</div>
                            <div id="foundLocation" class="font-mono text-sm font-semibold text-indigo-700 skeleton text-center md:text-left">...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-4 space-y-6">
                
                <div class="glass-panel rounded-3xl p-6 sticky top-6 slide-up delay-300">
                    <div class="mb-6">
                        <h3 class="font-bold text-xl text-gray-900">Verification Status</h3>
                        <p class="text-sm text-gray-500 mt-1">Live updates from system</p>
                    </div>

                    <div class="space-y-6 relative pl-2">
                        <div class="absolute left-[19px] top-3 bottom-8 w-0.5 bg-gray-200"></div>

                        <div class="relative flex items-start gap-4 opacity-50 grayscale transition-all duration-500" id="step1">
                            <div class="w-10 h-10 rounded-full bg-white border-2 border-green-500 flex items-center justify-center text-green-500 z-10 shadow-sm flex-shrink-0">
                                <i class="fas fa-file-upload text-sm"></i>
                            </div>
                            <div class="pt-2">
                                <h4 class="font-bold text-gray-800 text-sm">Item Reported</h4>
                                <span class="text-xs text-gray-400">Database entry created</span>
                            </div>
                        </div>

                        <div class="relative flex items-start gap-4 opacity-50 grayscale transition-all duration-500" id="step2">
                            <div class="w-10 h-10 rounded-full bg-white border-2 border-indigo-500 flex items-center justify-center text-indigo-500 z-10 shadow-sm flex-shrink-0">
                                <i class="fas fa-brain text-sm"></i>
                            </div>
                            <div class="pt-2">
                                <h4 class="font-bold text-gray-800 text-sm">AI Analysis</h4>
                                <span class="text-xs text-gray-400" id="aiStatusText">Processing vectors...</span>
                            </div>
                        </div>

                        <div class="relative flex items-start gap-4 opacity-50 transition-all duration-500" id="step3">
                            <div class="w-10 h-10 rounded-full bg-white border-2 border-gray-300 flex items-center justify-center text-gray-400 z-10 shadow-sm flex-shrink-0" id="statusIcon">
                                <i class="fas fa-flag text-sm"></i>
                            </div>
                            <div class="pt-2">
                                <h4 class="font-bold text-gray-800 text-sm" id="finalStatusTitle">Pending Decision</h4>
                                <span class="inline-block mt-1 px-2 py-0.5 rounded text-[10px] font-bold bg-gray-100 text-gray-500 uppercase" id="statusBadge">WAITING</span>
                            </div>

                            
                        </div>
                        <div class="p-6 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-3xl text-white shadow-lg slide-up delay-300">
                    <i class="fas fa-shield-alt text-3xl mb-3 opacity-80"></i>
                    <h4 class="font-bold text-lg mb-2">System Confidence</h4>
                    <p class="text-indigo-100 text-sm opacity-90 leading-relaxed">
                        The AI has identified significant visual and metadata correlations. Please review the images carefully before claiming.
                    </p>
                 </div>
                    </div>
                </div>

                
            </div>

        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            const matchId = params.get("match_id");
            const token = localStorage.getItem("token");
            
            // --- UI ANIMATION HELPERS ---
            function animateScore(target) {
                const circle = document.getElementById('scoreRing');
                const text = document.getElementById('scoreText');
                const radius = 56;
                const circumference = 2 * Math.PI * radius; // ~351
                const offset = circumference - (target / 100) * circumference;
                
                // Color Logic
                let color1 = "#4f46e5"; // Indigo
                let color2 = "#06b6d4"; // Cyan
                
                if(target > 80) { color1="#16a34a"; color2="#4ade80"; } // Green
                else if(target < 50) { color1="#ea580c"; color2="#facc15"; } // Orange/Yellow

                // Update Gradient
                const gradient = document.getElementById('gradient');
                gradient.innerHTML = `<stop offset="0%" stop-color="${color1}" /><stop offset="100%" stop-color="${color2}" />`;

                // Animate Ring
                setTimeout(() => {
                    circle.style.strokeDashoffset = offset;
                }, 500);

                // Count Up Number
                let start = 0;
                const duration = 2000;
                const startTime = performance.now();
                
                function update(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // EaseOutExpo
                    const ease = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);
                    
                    text.innerText = Math.floor(start + (target - start) * ease) + "%";
                    
                    if (progress < 1) requestAnimationFrame(update);
                }
                requestAnimationFrame(update);
            }

            function updateTimeline(status, score) {
                const s1 = document.getElementById('step1');
                const s2 = document.getElementById('step2');
                const s3 = document.getElementById('step3');
                
                // Activate Step 1
                setTimeout(() => { 
                    s1.classList.remove('opacity-50', 'grayscale'); 
                }, 200);

                // Activate Step 2
                setTimeout(() => { 
                    s2.classList.remove('opacity-50', 'grayscale');
                    document.getElementById('aiStatusText').textContent = `Vector Match: ${score}%`;
                }, 800);

                // Activate Step 3
                setTimeout(() => {
                    s3.classList.remove('opacity-50');
                    const iconBox = document.getElementById('statusIcon');
                    const badge = document.getElementById('statusBadge');
                    const title = document.getElementById('finalStatusTitle');
                    const icon = iconBox.querySelector('i');

                    if(status === 'APPROVED' || status === 'RECLAIMED') {
                        iconBox.className = "w-10 h-10 rounded-full bg-green-500 border-2 border-green-600 flex items-center justify-center text-white z-10 shadow-lg shadow-green-500/40 transform scale-110 transition-transform";
                        icon.className = "fas fa-check";
                        title.textContent = status === 'RECLAIMED' ? "Item Claimed" : "Match Verified";
                        badge.className = "inline-block mt-1 px-2 py-0.5 rounded text-[10px] font-bold bg-green-100 text-green-700 border border-green-200";
                        badge.textContent = status;
                    } else if (status === 'REJECTED') {
                        iconBox.className = "w-10 h-10 rounded-full bg-red-500 border-2 border-red-600 flex items-center justify-center text-white z-10 shadow-lg shadow-red-500/40";
                        icon.className = "fas fa-times";
                        title.textContent = "Match Rejected";
                        badge.className = "inline-block mt-1 px-2 py-0.5 rounded text-[10px] font-bold bg-red-100 text-red-700 border border-red-200";
                        badge.textContent = "REJECTED";
                    } else {
                        // Pending
                        iconBox.className = "w-10 h-10 rounded-full bg-white border-2 border-yellow-400 flex items-center justify-center text-yellow-500 z-10 shadow-sm animate-pulse";
                        icon.className = "fas fa-clock";
                    }
                }, 1600);
            }

            // --- DATA LOADING ---
            async function loadData() {
                try {
                    // MOCK DATA for Demo Purposes if API fails (Remove in production)
                    // const match = { match_id: "1024", created_at: new Date(), similarity_score: 0.88, status: "APPROVED", lost: { item_type: "MacBook Pro", brand: "Apple", color: "Space Grey", image_path: "", description: "Left in library", lost_location: "Library" }, found: { item_type: "Laptop", brand: "Apple", color: "Grey", image_path: "", description: "Found on table 4", lost_location: "Central Lib" }};
                    
                    const res = await fetch(`http://127.0.0.1:8000/matches/match/${matchId}`, {
                        headers: { Authorization: "Bearer " + token }
                    });
                    if(!res.ok) throw new Error("API Error");
                    const match = await res.json();
                    
                    const lost = match.lost;
                    const found = match.found;
                    const score = Math.round((match.similarity_score || 0) * 100);

                    // Fill Header
                    document.getElementById('displayMatchId').textContent = match.match_id;
                    document.getElementById('displayMatchId').classList.remove('skeleton');
                    document.getElementById('displayDate').textContent = new Date(match.created_at).toLocaleDateString();
                    document.getElementById('displayDate').classList.remove('skeleton');

                    // Fill Fields
                    const setText = (id, txt) => {
                        const el = document.getElementById(id);
                        if(el) {
                            el.textContent = txt || "--";
                            el.classList.remove('skeleton');
                        }
                    };

                    setText('lostTitle', lost.item_type);
                    setText('lostDescription', lost.description);
                    setText('lostBrand', lost.brand);
                    setText('lostColor', lost.color);
                    setText('lostLocation', lost.lost_location);

                    setText('foundTitle', found.item_type);
                    setText('foundDescription', found.description);
                    setText('foundBrand', found.brand);
                    setText('foundColor', found.color);
                    setText('foundLocation', found.lost_location);

                    // Images
                    // Images
const setImg = (id, path) => {
    const img = document.getElementById(id);
    
    // Define the fallback URL
    const fallback = "https://via.placeholder.com/400?text=No+Image";

    // Prevent loop if fallback fails
    img.onerror = () => {
        img.onerror = null; // STOP THE LOOP
        img.src = fallback;
    };

    if(path) {
        img.src = `http://127.0.0.1:8000/${path}`;
    } else {
        img.src = fallback;
    }
};
                    setImg('lostImage', lost.image_path);
                    setImg('foundImage', found.image_path);

                    // Trigger Animations
                    animateScore(score);
                    updateTimeline(match.status, score);

                } catch (e) {
                    console.error(e);
                }
            }

            if(matchId) loadData();
        });
    </script>
</body>
</html>